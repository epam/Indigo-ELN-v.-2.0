<div class="flex flex-col gap-1" [class.text-red-200]="hasError">
  <label *ngIf="label" class="text-sm font-medium">
    {{ label }}
    <span *ngIf="required" class="text-red-200">*</span>
  </label>

  <div #dropdownContainer class="select-container relative text-sm">
    <div
      [class]="
        {
          'select-trigger relative inline-flex w-full items-center gap-2 rounded-sm border px-3 py-2 transition-colors duration-200 cursor-pointer select-none': true,
          'bg-neutral-100': isOpen && !disabled,
          'cursor-not-allowed': disabled,
          'border-neutral-300': !isOpen,
          'border-primary-400': isOpen,
          'hover:bg-neutral-100': !isOpen && !disabled,
          'hover:border-primary-400': !disabled,
          'active:bg-neutral-200': !disabled,
          'opacity-60': disabled,
          'border-red-200': hasError,
        } | classPicker
      "
      (click)="toggleDropdown($event)"
    >
      @if (!multiple) {
        <em *ngIf="selectedLabel" class="indicon-check text-primary-400"></em>
        <span
          [class.text-neutral-500]="!selectedLabel"
          class="dd-label"
          [class.dd-placeholder]="!selectedLabel"
        >
          {{ selectedLabel || placeholder }}
        </span>
      }

      @if (multiple) {
        <div class="flex flex-wrap gap-1 flex-1 min-w-0">
          @if (selectedValues.length > 0) {
            @if (renderChips) {
              <app-chip
                *ngFor="let val of selectedValues; let i = index"
                (emitClose)="removeItem(val, null)"
                [deleteable]="!disabled"
                [error]="hasError"
                [active]="!disabled"
              >
                {{ getItemLabel(val) }}
              </app-chip>
            } @else {
              <div
                *ngFor="let val of selectedValues; let i = index"
                [class]="
                  {
                    'inline-flex items-center gap-1 bg-primary-alpha-10 text-primary-500 px-2 py-0.5 rounded-sm': true,
                    'bg-red-alpha-10 text-red-200': hasError,
                  } | classPicker
                "
              >
                <span class="truncate">
                  {{ getItemLabel(val) }}
                </span>
                <em
                  class="indicon-close cursor-pointer text-lg hover:bg-red-200 hover:text-neutral rounded-sm transition-colors duration-200"
                  (click)="removeItem(val, $event)"
                ></em>
              </div>
            }
          } @else {
            <span class="text-neutral-500 dd-placeholder">
              {{ placeholder }}
            </span>
          }
        </div>
      }

      <em
        class="indicon-chevron_down ml-auto transition-transform duration-200"
        [class.rotate-180]="isOpen"
      ></em>
    </div>

    @if (isOpen) {
      <ul
        #dropdownList
        [@dropdownAnimation]
        class="absolute bg-neutral border border-neutral-300 rounded-sm shadow-lg z-50 whitespace-nowrap w-full max-h-60 overflow-y-auto"
        [class.top-full]="dropdownDirection === 'down'"
        [class.bottom-full]="dropdownDirection === 'up'"
        [class.mt-1]="dropdownDirection === 'down'"
        [class.mb-1]="dropdownDirection === 'up'"
        [class.left-0]="dropdownAlignment === 'left'"
        [class.right-0]="dropdownAlignment === 'right'"
      >
        @for (item of items; track item) {
          <li
            class="px-3 py-2 flex items-center gap-2 text-neutral-1000 text-sm hover:bg-neutral-100"
            [class.bg-primary-alpha-10]="isSelected(item)"
            [class.text-primary-400]="isSelected(item)"
            [class.opacity-50]="item.disabled"
            [class.cursor-not-allowed]="item.disabled"
            [class.cursor-pointer]="!item.disabled"
            (click)="!item.disabled && selectItem(item, $event)"
          >
            <!-- Checkbox for multiselect -->
            @if (multiple) {
              <div
                class="w-4 h-4 border rounded flex items-center justify-center"
                [class.border-primary-400]="isSelected(item)"
                [class.bg-primary-400]="isSelected(item)"
              >
                <em
                  *ngIf="isSelected(item)"
                  class="indicon-check text-white text-xs"
                ></em>
              </div>
            }

            <!-- Icon for single select -->
            <em *ngIf="!multiple && item.icon" [class]="item.icon"></em>

            <span class="flex-1 truncate">{{ item.label }}</span>

            <!-- Checkmark for single select -->
            <em
              *ngIf="!multiple && isSelected(item)"
              class="indicon-check-circle ml-auto"
            ></em>
          </li>
        }
      </ul>
    }
  </div>
</div>
